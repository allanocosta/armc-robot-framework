# Python package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/python

trigger:
  - '*'
jobs:
  - job: Run Mobile Testa
    strategy:
      matrix:
        browser: [chromium, firefox, webkit]

  - job: ConfigureEnv
    displayName: "Print Browsers"
    pool:
      vmImage: 'ubuntu-latest'

    steps:
    - script: echo "Executando o job nos navegadores $browser"
    diaplayName: "Install Python"
    
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.10'
        addToPath: true
      displayName: "Use Python 3.10"

  - job: InstallDeps
    displayName: "Installing dependencies"
    dependsOn: ConfigureEnv
    steps:
    - script: |
      python -m pip install --upgrade pip
      pip install -r web_requirements.txt
      rfbrowser init
    displayName: 'Install dependencies'

  - job: RunTests
    displayName: "Run Web Tests"
    dependsOn: InstallDeps
    - script: |
      robot -d ./logs_web -x output-xunit.xml --listener RetryFailed --variable BROWSER:$browser -e servicetest -e mobiletest .
    continueOnError: true

  - job: PublishTestResults@2
    dependsOn: RunTests
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: 'logs_web/output-xunit.xml'
    displayName: 'Publish Test Results'
