trigger:
  - main

  pr:
  - main

  pool:
    vmImage: 'ubuntu-latest'

  jobs:
  - job: RunRobotTests
    strategy:
      matrix:
        browser:
          - chromium
          - firefox
          - webkit

    steps:
    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.x' # Especifique a versão do Python que deseja usar
        addToPath: true

    - script: pip install --upgrade pip
      displayName: 'Upgrade Pip'

    - script: pip install -r requirements.txt
      displayName: 'Install Requirements'

    - task: DownloadPipelineArtifact@2
      inputs:
        source: 'current' # Substitua pelo nome do seu pipeline de construção se for diferente
        path: $(System.ArtifactsDirectory)

    - task: UsePythonVersion@0
      inputs:
        versionSpec: '3.x'
        addToPath: true

    - script: |
        python -m pip install --upgrade pip
        pip install -r web_requirements.txt
        rfbrowser init
      displayName: 'Install dependencies'

    - script: |
        robot -d ./logs_web -x output-xunit.xml --listener RetryFailed -v BROWSER:$(browser) -e servicetest -e mobiletest .
      displayName: 'Run Robot Tests'

    - task: PublishTestResults@2
      inputs:
        testResultsFormat: 'JUnit'
        testResultsFiles: 'logs_web/output-xunit.xml'
      displayName: 'Publish Test Results'
