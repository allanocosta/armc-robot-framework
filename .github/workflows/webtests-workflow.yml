name: Run Web Tests
run-name: On Push - Web Tests Run
on: [push]

jobs:
    web-tests:
        runs-on: windows-latest
        permissions: write-all
        steps:
            -   name: Checkout
                uses: actions/checkout@v3

            -   name: Install Python 3.10
                uses: actions/setup-python@v4
                with:
                    python-version: '3.10'

            -   name: Install Node.js latest
                uses: actions/setup-node@v3
                with:
                    node-version: 'latest'

            -   name: Install Requiriments
                run: |
                    python -m pip install --upgrade pip
                    pip install -U -r web_requirements.txt
                    rfbrowser init

            -   name: Run RF Web Tests
                run: robot -d ./logs_web -e servicetest -e mobiletest .

            -   name: Upload Tests Results
                if: always()
                uses: actions/upload-artifact@v3
                with:
                    name: results-chromium
                    path: ./logs_web
                    if-no-files-found: ignore
                    retention-days: 2

            -   name: Download Tests Results
                if: always()
                uses: actions/download-artifact@v1
                with:
                    name: results-chromium
                
            -   name: Send Report
                if: always()
                uses: joonvena/robotframework-reporter-action@v2.1
                with:
                    report_path: results-chromium
                    gh_access_token: ${{ secrets.GITHUB_TOKEN }}
                    show_passed_tests: false